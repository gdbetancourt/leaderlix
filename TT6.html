<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <title>Evaluación de Presentaciones – Radar D / P</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root{
      --dispo:#1c1e2c;
      --persu:#ff3300;
    }
    body{font-family:Arial,sans-serif;margin:0;background:#fafafa;padding:24px}
    .container{display:flex;flex-direction:column;align-items:center;gap:30px}
    #timer{font-size:48px;font-weight:700;text-align:right}
    .controls{display:flex;gap:10px;flex-wrap:wrap;width:100%;max-width:560px}
    .controls input{flex:1;padding:10px;font-size:16px;border:1px solid #ccc;border-radius:6px}
    .controls button{padding:10px 18px;font-size:16px;border:none;border-radius:6px;color:#fff;cursor:pointer}
    #startStopButton,#pauseResumeButton{background:var(--dispo)}
    #startStopButton[disabled],#pauseResumeButton[disabled]{opacity:.45;cursor:default}
    .radial-board{position:relative;width:420px;height:420px}
    .circle-btn{position:absolute;width:70px;height:70px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:22px;font-weight:600;border:none;color:#fff;cursor:pointer;transform:translate(-50%,-50%)}
    .btn-D{background:var(--dispo);z-index:1}
    .btn-P{background:var(--persu);z-index:2}
    .label{position:absolute;transform:translate(-50%,-50%);font-size:18px;color:#666;font-weight:600;pointer-events:none}
    .summaries{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;max-width:900px;width:100%}
    .summary-item{background:#fff;border:1px solid #e1e1e1;border-radius:6px;padding:8px 10px;font-size:15px;line-height:1.35}
    .summary-item .time{font-weight:700}
    .summary-item .pct{color:#777}
    .chart-box{width:550px;max-width:90vw;border:2px solid #222;padding:16px;background:#fff;border-radius:10px;box-shadow:0 2px 6px rgba(0,0,0,.08)}
    canvas{width:100%!important;height:100%!important}
    #mainSection{display:none}
    #objectiveSection .slider-row{display:flex;align-items:center;gap:12px;width:100%;max-width:500px}
    #objectiveSection input[type=range]{flex:1}
    #objectiveSection label{width:110px}
    #goal-total{font-weight:700}
    #goal-total.error{color:#ff3300}
  </style>
</head>
<body>
<div id="objectiveSection" class="container">
  <div id="slidersWrapper">
    <div class="slider-row"><label for="goal-Atención">Atención</label><input id="goal-Atención" type="range" min="0" max="100" value="0" oninput="updateGoal('Atención',this.value)"/><span id="goal-Atención-val">0%</span></div>
    <div class="slider-row"><label for="goal-Credibilidad">Credibilidad</label><input id="goal-Credibilidad" type="range" min="0" max="100" value="0" oninput="updateGoal('Credibilidad',this.value)"/><span id="goal-Credibilidad-val">0%</span></div>
    <div class="slider-row"><label for="goal-Inspiración">Inspiración</label><input id="goal-Inspiración" type="range" min="0" max="100" value="0" oninput="updateGoal('Inspiración',this.value)"/><span id="goal-Inspiración-val">0%</span></div>
    <div class="slider-row"><label for="goal-Aplicabilidad">Aplicabilidad</label><input id="goal-Aplicabilidad" type="range" min="0" max="100" value="0" oninput="updateGoal('Aplicabilidad',this.value)"/><span id="goal-Aplicabilidad-val">0%</span></div>
    <div class="slider-row"><label for="goal-Apertura">Apertura</label><input id="goal-Apertura" type="range" min="0" max="100" value="0" oninput="updateGoal('Apertura',this.value)"/><span id="goal-Apertura-val">0%</span></div>
    <div class="slider-row"><label for="goal-Asombro">Asombro</label><input id="goal-Asombro" type="range" min="0" max="100" value="0" oninput="updateGoal('Asombro',this.value)"/><span id="goal-Asombro-val">0%</span></div>
  </div>
  <div id="goal-total">Total: 0%</div>
  <button id="goalNextBtn" onclick="showMainSection()" disabled>Siguiente</button>
</div>

<div id="mainSection" class="container">
  <div id="timer">00:00:00</div>
  <div class="controls">
    <input id="personName" type="text" placeholder="Nombre" oninput="validateName()"/>
    <button id="startStopButton" onclick="startStopTimer()" disabled>Comenzar</button>
    <button id="pauseResumeButton" onclick="pauseResumeTimer()" disabled>Pausa</button>
  </div>
  <div class="radial-board">
    <span class="label" style="top:35px;left:210px">Atención</span>
    <span class="label" style="top:125px;left:390px">Credibilidad</span>
    <span class="label" style="top:295px;left:390px">Inspiración</span>
    <span class="label" style="top:385px;left:210px">Aplicabilidad</span>
    <span class="label" style="top:295px;left:30px">Apertura</span>
    <span class="label" style="top:125px;left:30px">Asombro</span>

    <button class="circle-btn btn-P" style="top:80px;left:210px" onclick="setCategory('Atención','P')">P</button>
    <button class="circle-btn btn-P" style="top:160px;left:335px" onclick="setCategory('Credibilidad','P')">P</button>
    <button class="circle-btn btn-P" style="top:250px;left:335px" onclick="setCategory('Inspiración','P')">P</button>
    <button class="circle-btn btn-P" style="top:330px;left:210px" onclick="setCategory('Aplicabilidad','P')">P</button>
    <button class="circle-btn btn-P" style="top:250px;left:85px" onclick="setCategory('Apertura','P')">P</button>
    <button class="circle-btn btn-P" style="top:160px;left:85px" onclick="setCategory('Asombro','P')">P</button>

    <button class="circle-btn btn-D" style="top:120px;left:210px" onclick="setCategory('Atención','D')">D</button>
    <button class="circle-btn btn-D" style="top:195px;left:290px" onclick="setCategory('Credibilidad','D')">D</button>
    <button class="circle-btn btn-D" style="top:235px;left:290px" onclick="setCategory('Inspiración','D')">D</button>
    <button class="circle-btn btn-D" style="top:300px;left:210px" onclick="setCategory('Aplicabilidad','D')">D</button>
    <button class="circle-btn btn-D" style="top:235px;left:130px" onclick="setCategory('Apertura','D')">D</button>
    <button class="circle-btn btn-D" style="top:195px;left:130px" onclick="setCategory('Asombro','D')">D</button>
  </div>
  <div class="summaries" id="summaryGrid"></div>
  <div class="chart-box"><canvas id="radarChart" width="500" height="450"></canvas></div>
</div>

<script>
const categoryList=['Atención','Credibilidad','Inspiración','Aplicabilidad','Apertura','Asombro'];
const dispoCategories=Object.fromEntries(categoryList.map(c=>[c,0]));
const categories=Object.fromEntries(categoryList.map(c=>[c,0]));
const goals=Object.fromEntries(categoryList.map(c=>[c,0]));
let timerRunning=false,paused=false;
let startTime=0,pausedTime=0,totalElapsedTime=0,lastCategoryPressTime=0;
let timerInterval,statsInterval,radarInstance;

const pad=n=>n<10?`0${n}`:n;
const formatTime=ms=>{const s=Math.floor(ms/1000),h=Math.floor(s/3600),m=Math.floor((s%3600)/60),sec=s%60;return `${pad(h)}:${pad(m)}:${pad(sec)}`};

function updateGoal(category,val){
  val=parseInt(val,10);
  const othersTotal=Object.keys(goals).reduce((a,c)=>c===category?a: a+goals[c],0);
  if(othersTotal+val>100){
    val=100-othersTotal;
    document.getElementById(`goal-${category}`).value=val;
  }
  goals[category]=val;
  document.getElementById(`goal-${category}-val`).textContent=val+"%";
  updateGoalTotal();
}

function updateGoalTotal(){
  const total=Object.values(goals).reduce((a,b)=>a+b,0);
  const el=document.getElementById('goal-total');
  el.textContent=`Total: ${total}%`;
  if(total===100){
    el.classList.remove('error');
    document.getElementById('goalNextBtn').disabled=false;
  }else{
    document.getElementById('goalNextBtn').disabled=true;
    if(total>100)el.classList.add('error');
    else el.classList.remove('error');
  }
}

function showMainSection(){
  document.getElementById('objectiveSection').style.display='none';
  document.getElementById('mainSection').style.display='flex';
  validateName();
}

const grid=document.getElementById('summaryGrid');
categoryList.forEach(cat=>{
  const div=document.createElement('div');div.className='summary-item';
  div.innerHTML=`${cat}<br>D <span id=\"${cat}-D-time\" class=\"time\">00:00:00</span> (<span id=\"${cat}-D-pct\" class=\"pct\">0%</span>) – P <span id=\"${cat}-P-time\" class=\"time\">00:00:00</span> (<span id=\"${cat}-P-pct\" class=\"pct\">0%</span>)`;
  grid.appendChild(div);
});

function validateName(){document.getElementById('startStopButton').disabled=document.getElementById('personName').value.trim()==='';}
function resetAll(){paused=false;totalElapsedTime=0;startTime=pausedTime=0;
  categoryList.forEach(c=>{dispoCategories[c]=0;categories[c]=0;});
  document.getElementById('timer').textContent='00:00:00';updateStats();
  if(radarInstance)radarInstance.destroy();
}

function startStopTimer(){
  if(!timerRunning){
    resetAll();startTime=performance.now();lastCategoryPressTime=startTime;
    timerInterval=setInterval(updateTimerDisplay,1000);
    statsInterval=setInterval(updateStats,1000);
    timerRunning=true;
    document.getElementById('startStopButton').textContent='Detener';
    document.getElementById('pauseResumeButton').disabled=false;
    document.getElementById('personName').disabled=true;
  }else{
    clearInterval(timerInterval);clearInterval(statsInterval);
    updateTimerDisplay();updateStats();timerRunning=false;
    document.getElementById('startStopButton').textContent='Comenzar';
    document.getElementById('pauseResumeButton').disabled=true;
    document.getElementById('personName').disabled=false;
    drawRadarChart();
  }
}

function pauseResumeTimer(){
  if(!paused){
    clearInterval(timerInterval);clearInterval(statsInterval);
    pausedTime=performance.now();paused=true;
    document.getElementById('pauseResumeButton').textContent='Reanudar';
  }else{
    const now=performance.now(),delta=now-pausedTime;
    startTime+=delta;lastCategoryPressTime+=delta;
    timerInterval=setInterval(updateTimerDisplay,1000);
    statsInterval=setInterval(updateStats,1000);
    paused=false;
    document.getElementById('pauseResumeButton').textContent='Pausa';
  }
}

function setCategory(categoryName,type){
  if(!timerRunning||paused)return;
  const now=performance.now(),elapsed=now-lastCategoryPressTime;
  if(type==='D'){dispoCategories[categoryName]+=elapsed;}
  else if(type==='P'){categories[categoryName]+=elapsed;}
  lastCategoryPressTime=now;
  updateStats();
}

function updateTimerDisplay(){
  const now=performance.now(),elapsed=now-startTime;
  if(!paused)totalElapsedTime=elapsed;
  document.getElementById('timer').textContent=formatTime(elapsed);
}

function updateStats(){
  categoryList.forEach(c=>{
    const dTime=dispoCategories[c],pTime=categories[c];
    const dPct=totalElapsedTime?dTime/totalElapsedTime*100:0;
    const pPct=totalElapsedTime?pTime/totalElapsedTime*100:0;
    document.getElementById(`${c}-D-time`).textContent=formatTime(dTime);
    document.getElementById(`${c}-P-time`).textContent=formatTime(pTime);
    document.getElementById(`${c}-D-pct`).textContent=dPct.toFixed(1)+'%';
    document.getElementById(`${c}-P-pct`).textContent=pPct.toFixed(1)+'%';
  });
}

function drawRadarChart(){
  const ctx=document.getElementById('radarChart').getContext('2d');
  const dispoData=categoryList.map(c=>totalElapsedTime?(dispoCategories[c]/totalElapsedTime*100).toFixed(2):0);
  const persuData=categoryList.map(c=>totalElapsedTime?(categories[c]/totalElapsedTime*100).toFixed(2):0);
  const goalData=categoryList.map(c=>goals[c]);

  if(radarInstance)radarInstance.destroy();
  radarInstance=new Chart(ctx,{
    type:'radar',
    data:{
      labels:categoryList,
      datasets:[
        {
          label:'Objetivo',
          data:goalData,
          backgroundColor:'rgba(0,128,0,0.25)',
          borderColor:'green',
          borderWidth:2,
          borderJoinStyle:'round',
          tension:0.25,
          pointRadius:0
        },
        {
          label:'Persuasión',
          data:persuData,
          backgroundColor:'rgba(255,51,0,0.3)',
          borderColor:'#ff3300',
          borderWidth:2,
          borderJoinStyle:'round',
          tension:0.25,
          pointRadius:0
        },
        {
          label:'Disponibilización',
          data:dispoData,
          backgroundColor:'rgba(28,30,44,0.3)',
          borderColor:'#1c1e2c',
          borderWidth:2,
          borderJoinStyle:'round',
          tension:0.25,
          pointRadius:0
        }
      ]
    },
    options:{
      scales:{
        r:{
          beginAtZero:true,
          max:100,
          ticks:{display:false},
          grid:{color:'#ccc'},
          pointLabels:{font:{size:14},color:'#333'}
        }
      },
      plugins:{
        legend:{position:'top'}
      }
    }
  });
}
</script>
</body>
</html>
