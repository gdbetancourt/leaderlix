<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Opciones de Inscripción — Vista Corporativa</title>
<link href="https://fonts.googleapis.com/css2?family=Gochi+Hand&display=swap" rel="stylesheet">
<style>
  :root{ --gap:16px; --radius:16px; --bg:#ffffff; --card:#ffffff; --bord:#e5e7eb; --muted:#49566a; --accent:#ff3300; --text:#111111; --ok:#16a34a; --warn:#c2410c; --shadow:0 6px 24px rgba(0,0,0,.06);}
  *{box-sizing:border-box} body{margin:0;font-family:Arial,Helvetica,sans-serif;background:var(--bg);color:var(--text)}
  .container{max-width:1100px;margin:0 auto;padding:28px 20px 64px}
  h1{margin:0 0 8px;font-size:36px;text-align:center;font-family:"Gochi Hand",Arial,Helvetica,sans-serif;color:var(--accent)}
  .muted{color:var(--muted);text-align:center;margin-bottom:18px}
  .grid{display:grid;gap:var(--gap)} .row3{grid-template-columns:repeat(3,1fr)} @media (max-width:980px){.row3{grid-template-columns:1fr}}
  .card{background:var(--card);border:1px solid var(--bord);border-radius:var(--radius);padding:20px;box-shadow:var(--shadow)}
  .pricing{display:flex;flex-direction:column;gap:14px}
  .title{font-weight:800;font-size:26px;text-align:center;margin-bottom:6px;font-family:"Gochi Hand",Arial,Helvetica,sans-serif;color:var(--accent)}
  .label{color:#334155;font-size:14px} .subtle{color:#64748b;font-size:13px}
  .line{display:flex;justify-content:space-between;align-items:center;gap:12px;padding-top:6px}
  select,input[type="text"],input[type="number"],input[type="email"],input[type="tel"],textarea{width:100%;background:#fff;color:#111;border:1px solid #c9d1db;border-radius:12px;padding:10px 12px;font-size:15px}
  textarea{min-height:88px;resize:vertical} button{background:var(--accent);color:#fff;border:none;border-radius:10px;padding:10px 14px;cursor:pointer;font-weight:700}
  .hint{color:#64748b;font-size:12px} .hidden{display:none}
  ul.benefits{list-style:none;margin:6px 0 0;padding:0;display:flex;flex-direction:column;gap:6px}
  ul.benefits li{display:flex;gap:8px;align-items:flex-start;font-size:15px}
  .check{font-weight:700} .off{color:#94a3b8} .off s{color:inherit}
  .grand{font-weight:800;font-size:22px;color:var(--accent)}
  #top-controls{display:flex;gap:24px;justify-content:center;align-items:center;margin:8px 0 22px}
  .toggle{position:relative;width:160px;height:40px;background:#fff;border:1px solid #c9d1db;border-radius:999px;cursor:pointer}
  .toggle::after{content:"";position:absolute;top:4px;left:4px;width:32px;height:32px;background:var(--accent);border-radius:50%;transition:left .18s ease}
  .toggle.right::after{left:124px}
  .coupon-row{display:grid;grid-template-columns:1fr auto;gap:10px;align-items:center;margin-top:10px}
  .sum-grid{display:grid;grid-template-columns:1fr auto auto;gap:8px;margin-top:10px}
  #errorBox{display:none;margin:10px auto 0;max-width:780px;background:#fff0f0;color:#7f1d1d;border:1px solid #fecaca;padding:10px 12px;border-radius:8px}
</style>
</head>
<body>
<div class="container">
  <h1>Opciones de Inscripción</h1>
  <div class="muted">Vista corporativa</div>
<div id="corp-hint" class="muted">Selecciona suficientes participantes en alguna membresía para activar el proyecto corporativo.</div>

  <div id="top-controls" aria-label="Preferencias">
    <div style="text-align:center">
      <div style="font-size:12px;color:#64748b;margin-bottom:6px">Moneda</div>
      <div id="currencyToggle" class="toggle" role="switch" aria-checked="false" title="Cambiar entre MXN y USD"></div>
      <div style="display:flex;justify-content:space-between;font-size:13px;color:#64748b;margin-top:6px"><span>🇲🇽 MXN</span><span>USD 🇺🇸</span></div>
    </div>
  </div>

  <div id="errorBox" role="alert"></div>

<div id="gp-card" class="card hidden">
    <h3 style="margin:0 0 8px;font-size:22px;color:#111">Generales del Proyecto</h3>
    <div class="grid" style="grid-template-columns:1fr 1fr;gap:12px">
      <div><label class="label">Fecha de la propuesta</label><input id="gp-fecha" type="text" readonly></div>
      <div><label class="label">Vigencia de la propuesta</label><input id="gp-vigencia" type="text" readonly></div>
      <div><label class="label">Nombre de la empresa</label><input id="gp-empresa" type="text" placeholder="Ej. ACME S.A. de C.V."></div>
      <div><label class="label">Nombre de quien solicita</label><input id="gp-solicita" type="text" placeholder="Ej. Ana Pérez"></div>
      <div><label class="label">Responsable en Leaderlix</label><input id="gp-resp" type="text" placeholder="Ej. Gerardo Betancourt"></div>
      <div><label class="label">Teléfono</label><input id="gp-tel" type="tel" placeholder="Ej. +52 55 1234 5678"></div>
      <div><label class="label">Correo</label><input id="gp-mail" type="email" placeholder="Ej. contacto@empresa.com"></div>
      <div class="full" style="grid-column:1/-1"><label class="label">Generales del proyecto</label><textarea id="gp-notas" placeholder="Describe brevemente el contexto, objetivos, sede(s), fechas tentativas y consideraciones."></textarea></div>
    </div>
  </div>

  <div id="cards" class="grid row3" aria-live="polite"></div>
<div id="corp-benefits-detail" class="grid hidden" style="grid-template-columns:1fr;gap:12px;margin-top:12px"></div>

<div id="totales" class="card hidden">
    <div class="coupon-row">
      <input id="coupon-input" type="text" placeholder="Si tienes un cupón, ingrésalo aquí">
      <button id="coupon-apply">Aplicar cupón</button>
    </div>
    <div id="coupon-info" class="hint"></div>
    <div class="sum-grid">
      <div>Apertura del grupo</div><div id="t-met-count">—</div><div id="t-met">—</div>
      <div>Inscripciones <span class="hint">— Renovables a los 365 días</span></div><div id="t-subins-count">—</div><div id="t-subins">—</div>
      <div id="coupon-line-label" class="hidden">Cupón</div><div></div><div id="coupon-line-value" class="hidden">—</div>
    </div>
    <div class="grid" style="grid-template-columns:1fr auto;row-gap:8px;margin-top:12px">
      <div class="grand">Total antes de impuestos</div><div class="grand" id="t-corp">—</div>
      <div id="t-iva-label">IVA (16%)</div><div id="t-iva">—</div>
      <div id="t-conimp-label">Total con impuestos</div><div id="t-conimp">—</div>
    </div>
    <div class="line" style="justify-content:flex-start;gap:10px;margin-top:10px">
      <input id="pay-card" type="checkbox"><label for="pay-card" class="label">Pagar con tarjeta (se agrega 4.5%)</label>
    </div>
  </div>
</div>

<script>
/* ==================  DATOS 100% LOCALES  ================== */
const DATA = {
  escalas: [1,5,10,25,50,100],
  participantes: { autodidacta:0, yotenseno:0, lohagocontigo:0 },
  precios: {
    autodidacta:{ mxn:[3990,3800,3600,3300,3000,2700], usd:[239,229,219,199,179,159] },
    yotenseno:{ mxn:[6990,6700,6400,5900,5400,4900], usd:[399,389,369,339,309,279] },
    lohagocontigo:{ mxn:[14990,14500,13900,12900,11900,10900], usd:[899,869,839,779,719,659] }
  },
  descuentos:{
    autodidacta:[0,0.03,0.05,0.10,0.15,0.20],
    yotenseno:[0,0.03,0.05,0.10,0.15,0.20],
    lohagocontigo:[0,0.03,0.05,0.10,0.15,0.20]
  },
  beneficios:{
    nombres:["Curso in Company","Acceso a plataforma por 12 meses","Sesiones en vivo grupales","Coaching 1:1","Certificación por niveles","Soporte por correo","Materiales descargables","Reporte de participación"],
    detalle:[
      {descripcion:"Sesión exclusiva para el equipo, personalizada a sus objetivos."},
      {descripcion:"Ingreso a la plataforma con contenidos y prácticas durante un año."},
      {descripcion:"Calendario mensual de sesiones sin costo adicional."},
      {descripcion:"Acompañamiento individual con coaches de Leaderlix."},
      {descripcion:"Evaluación progresiva con 4 niveles de dominio."},
      {descripcion:"Atención a dudas y seguimiento por email."},
      {descripcion:"Plantillas, guías y ejemplos prácticos."},
      {descripcion:"Reporte mensual con métricas de avance."}
    ],
    autodidacta:[true,true,true,false,true,true,true,true],
    yotenseno:[true,true,true,true,true,true,true,true],
    lohagocontigo:[true,true,true,true,true,true,true,true]
  },
  condiciones:{ incompany:{ autodidacta:25, yotenseno:25, lohagocontigo:10 } },
  metodologia:{ mxn:29000, usd:1690, descuento:0.15 },
  cupones:{ CORP10:0.10, CORP15:0.15 }
};

/* ===============  LÓGICA UI =============== */
const MODS=[{key:"autodidacta",title:"Autodidacta"},{key:"yotenseno",title:"Yo Te Enseño"},{key:"lohagocontigo",title:"Lo Hago Contigo"}];
// ----- Mostrar/ocultar bloques corporativos según mínimos In Company -----
function qualifiesCorporate(){
  const mins = DATA?.condiciones?.incompany || {};
  const keys = ["autodidacta","yotenseno","lohagocontigo"];
  const anyMinConfigured = keys.some(k => Number(mins[k]||0) > 0);
  if(!anyMinConfigured) return false;
  return MODS.some(({key})=>{
    const min = Number(mins[key] || 0);
    const cnt = Number(document.getElementById("p-"+key)?.value || 0);
    return min > 0 && cnt >= min;
  });
}

function toggleCorporateBlocks(){
  const show = qualifiesCorporate();
  ["gp-card","corp-benefits-detail","gantt-card","totales","req-card"].forEach(id=>{
    const el = document.getElementById(id);
    if(!el) return;
    el.classList.toggle("hidden", !show);
  });

  // (Opcional) si quieres mostrar una pista cuando NO califica:
  const hint = document.getElementById("corp-hint");
  if(hint) hint.classList.toggle("hidden", show);
}

  let currency="mxn", appliedCoupon=null, inCompanyIndex = DATA.beneficios.nombres.findIndex(n => n.toLowerCase().includes("in company"));
const $ = s => document.querySelector(s);
const nfByCcy = c => new Intl.NumberFormat(c==="usd"?"en-US":"es-MX",{minimumFractionDigits:2,maximumFractionDigits:2});
const money = (n,c) => (c==="usd"?"USD":"MXN")+" $"+nfByCcy(c).format(Number(n||0));
const isIncluded = v => typeof v==="boolean" ? v : (String(v??"").trim().toLowerCase() in {si:1,"sí":1,yes:1,true:1,"1":1});

function findIndexFloor(arr,count){
  const c=Number(count); const exact=arr.indexOf(c); if(exact>=0) return exact;
  let best=-1,val=-Infinity; for(let i=0;i<arr.length;i++){ const v=Number(arr[i]); if(v<=c && v>val){ val=v; best=i; } }
  return best;
}
function getPrice(mod,count,ccy){
  const idx=findIndexFloor(DATA.escalas,count);
  if(idx<0) return {ok:false,price:0,discount:0,scale:null};
  return { ok:true, price:Number(DATA.precios[mod][ccy][idx])||0, discount:Number(DATA.descuentos[mod][idx])||0, scale:Number(DATA.escalas[idx])||0 };
}

function buildCards(){
  const container=$("#cards"); container.innerHTML="";
  MODS.forEach(({key,title})=>{
    const card=document.createElement("div"); card.className="card pricing";
    const h=document.createElement("div"); h.className="title"; h.textContent=title; card.appendChild(h);

    const line=document.createElement("div"); line.className="line";
    const lbl=document.createElement("label"); lbl.className="label"; lbl.textContent="Participantes"; lbl.htmlFor="p-"+key;
    const inp=document.createElement("input"); inp.type="number"; inp.min="0"; inp.step="1"; inp.id="p-"+key; inp.value=DATA.participantes[key]||0;
    line.appendChild(lbl); line.appendChild(inp); card.appendChild(line);

    const st=document.createElement("div"); st.className="line";
    st.innerHTML='<div>Subtotal <span class="hint">— Anualmente</span></div><div id="st-'+key+'">—</div>'; card.appendChild(st);

    const pp=document.createElement("div"); pp.className="line";
    pp.innerHTML='<div>Precio por persona</div><div id="pp-'+key+'">—</div>'; card.appendChild(pp);

    const bl=document.createElement("div"); bl.className="subtle"; bl.textContent="Incluye:"; card.appendChild(bl);
    const ul=document.createElement("ul"); ul.className="benefits"; ul.id="b-"+key; card.appendChild(ul);

    container.appendChild(card);
    inp.addEventListener("input", ()=>{ recalc(true); renderBenefits(); });
  });
  renderBenefits();
}

// Módulo de detalle de beneficios (se rellena solo cuando califica corporativo)
function renderCorpBenefitDetails(){
  const box = document.getElementById("corp-benefits-detail");
  if(!box) return;

  // Si aún NO califica corporativo, no mostramos nada
  if(!qualifiesCorporate()){
    box.innerHTML = "";
    return;
  }

  const nombres = (DATA?.beneficios?.nombres) || [];
  const detalle = (DATA?.beneficios?.detalle) || [];
  box.innerHTML = "";

  for (let i = 0; i < nombres.length; i++){
    const name = String(nombres[i] || "").trim();
    if(!name) continue;
    const desc = String(
      (Array.isArray(detalle) ? (detalle[i]?.descripcion ?? detalle[i]) : "")
      || ""
    ).trim();

    const card = document.createElement("div");
    card.className = "card";
    const h = document.createElement("div");
    h.style.fontWeight = "700";
    h.style.marginBottom = "6px";
    h.textContent = name;
    const p = document.createElement("div");
    p.textContent = desc || "—";
    card.appendChild(h);
    card.appendChild(p);
    box.appendChild(card);
  }
}
function renderBenefits(){
  const names=DATA.beneficios.nombres.map(String);
  const cols={ autodidacta:DATA.beneficios.autodidacta, yotenseno:DATA.beneficios.yotenseno, lohagocontigo:DATA.beneficios.lohagocontigo };
  MODS.forEach(({key})=>{
    const ul=$("#b-"+key); if(!ul) return; ul.innerHTML="";
    names.forEach((nm,i)=>{
      const li=document.createElement("li");
      if(i===inCompanyIndex){ li.id=`inc-${key}`; ul.appendChild(li); return; }
      const on=isIncluded(cols[key][i]); const icon=document.createElement("span");
      if(on){ icon.className="check"; icon.textContent="✓"; li.appendChild(icon); li.appendChild(document.createTextNode(" "+nm)); }
      else { li.className="off"; icon.textContent="✗"; li.appendChild(icon); const s=document.createElement("s"); s.textContent=" "+nm; li.appendChild(s); }
      ul.appendChild(li);
    });
  });
  updateInCompanyLabels();
  renderCorpBenefitDetails();
}

function updateInCompanyLabels(){
  if(inCompanyIndex<0) return;
  const mins=DATA.condiciones.incompany;
  MODS.forEach(({key})=>{
    const li=$("#inc-"+key); if(!li) return;
    const min=Number(mins[key]||0);
    const cnt=Number($("#p-"+key)?.value||0);
    const qualifies = (min<=0) || (cnt>=min);
    li.innerHTML="";
    const base="Curso in Company"; const strong=document.createElement("strong"); if(min>0) strong.textContent=` (Desde ${min} px)`;
    if(qualifies){ const i=document.createElement("span"); i.className="check"; i.textContent="✓"; li.appendChild(i); li.appendChild(document.createTextNode(" "+base)); if(min>0) li.appendChild(strong); }
    else{ li.className="off"; const i=document.createElement("span"); i.textContent="✗"; li.appendChild(i); const s=document.createElement("s"); s.textContent=" "+base; li.appendChild(s); if(min>0) li.appendChild(strong); }
  });
}

function recalc(anim=false){
  let totalPart=0, subtotal=0;
  MODS.forEach(({key})=>{
    const cnt=Number($("#p-"+key).value||0);
    totalPart+=cnt;
    if(cnt>0){
      const pr=getPrice(key,cnt,currency);
      const groupPrice=pr.price*(1-pr.discount);
      subtotal+=groupPrice;
      $("#st-"+key).textContent = money(groupPrice,currency);
      $("#pp-"+key).textContent = money(groupPrice/Math.max(1,pr.scale||1),currency);
    }else{
      $("#st-"+key).textContent = money(0,currency);
      $("#pp-"+key).textContent = money(0,currency);
    }
  });

  // apertura (metodología) solo si hay al menos un paquete seleccionado
  const metBase = Number(DATA.metodologia[currency]||0);
  const metDesc = Number(DATA.metodologia.descuento||0);
  const hasAny = MODS.some(({key}) => Number($("#p-"+key).value||0) > 0);
  const apertura = hasAny ? metBase * (1 - metDesc) : 0;

  let totalAntes = subtotal + apertura;

  // cupón (si hubiera)
  let discountAmt = 0;
  if(appliedCoupon?.pct>0){
    discountAmt = totalAntes * appliedCoupon.pct;
    totalAntes = Math.max(0, totalAntes - discountAmt);
    $("#coupon-line-label").classList.remove("hidden");
    $("#coupon-line-value").classList.remove("hidden");
    $("#coupon-line-value").textContent = "− " + money(discountAmt, currency);
  }else{
    $("#coupon-line-label").classList.add("hidden");
    $("#coupon-line-value").classList.add("hidden");
  }

  const ivaPct = currency==="mxn" ? 0.16 : 0;
  const iva = totalAntes * ivaPct;
  $("#t-iva-label").textContent = ivaPct>0 ? `IVA (${Math.round(ivaPct*100)}%)` : "Impuestos";
  let totalDespues = totalAntes + iva;

  if($("#pay-card").checked){
    totalDespues += totalDespues * 0.045;
    $("#t-conimp-label").textContent = "Total con impuestos + fee tarjeta (4.5%)";
  }else{
    $("#t-conimp-label").textContent = "Total con impuestos";
  }

  $("#t-met-count").textContent = hasAny ? 1 : 0;
  $("#t-met").textContent = money(apertura,currency);
  $("#t-subins-count").textContent = totalPart;
  $("#t-subins").textContent = money(subtotal,currency);
  $("#t-corp").textContent = money(totalAntes,currency);
  $("#t-iva").textContent = money(iva,currency);
  $("#t-conimp").textContent = money(totalDespues,currency);

  renderBenefits(); // actualiza “In Company” según mínimos
  toggleCorporateBlocks(); // <<--- NUEVO: muestra/oculta módulos corporativos
}


/* Eventos */
document.addEventListener("DOMContentLoaded", ()=>{
  // Fechas de pantalla
  const now=new Date(); const plus30=new Date(now.getTime()+30*24*60*60*1000);
  const cap = d => d.toLocaleDateString('es-MX',{weekday:'long',day:'numeric',month:'long',year:'numeric'}).replace(/\b(de|del)\b/g,'$&');
  $("#gp-fecha").value = cap(now);
  $("#gp-vigencia").value = cap(plus30);

  // Toggle moneda
  const tog=$("#currencyToggle");
  const setCcy = c => { currency=c; tog.classList.toggle("right", currency==="usd"); tog.setAttribute("aria-checked", currency==="usd"?"true":"false"); recalc(true); };
  tog.addEventListener("click", ()=> setCcy(currency==="mxn"?"usd":"mxn"));
  tog.addEventListener("keydown", e => { if(e.key===" "||e.key==="Enter"){ e.preventDefault(); setCcy(currency==="mxn"?"usd":"mxn"); }});

  // Cupón
  $("#coupon-apply").addEventListener("click", ()=>{
    const raw = ($("#coupon-input").value||"").trim().toUpperCase();
    const info=$("#coupon-info");
    if(!raw){ appliedCoupon=null; info.textContent=""; recalc(true); return; }
    const pct = DATA.cupones[raw];
    if(!pct){ appliedCoupon=null; info.textContent="Cupón inválido o expirado."; recalc(true); return; }
    appliedCoupon = { code:raw, pct:Number(pct) };
    info.textContent = "✅ Cupón aplicado: " + Math.round(pct*100) + "%";
    recalc(true);
  });

  $("#pay-card").addEventListener("change", ()=>recalc(true));

  // Construir UI y calcular
  buildCards();
  recalc(true);
  toggleCorporateBlocks(); // <<--- NUEVO: aplica el estado inicial (oculto si no califica)

  // Aviso si hay extensiones ruidosas
  setTimeout(()=>{

    const noisy = /lastpass|1password|bitwarden|background-redux/i;
    // Si hay errores de esas extensiones, solo mostramos un aviso suave (no bloquea nada)
    window.addEventListener("error", e=>{
      if(noisy.test(String(e?.filename||""))) {
        const b=$("#errorBox"); b.style.display="block";
        b.textContent="Nota: Tu gestor de contraseñas está registrando errores en la consola, pero la vista corporativa funciona.";
      }
    });
  },0);
});
</script>
</body>
</html>
