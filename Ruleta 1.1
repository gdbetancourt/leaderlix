<style>
  @import url("https://fonts.googleapis.com/css2?family=Gochi+Hand&display=swap");

  :root {
    --ra-accent: #ff3300;
    --ra-secondary: #1c1e2c;
    --ra-text: #000000;
  }

  .ruleta-audiencias-widget {
    font-family: Arial, Helvetica, sans-serif;
    color: var(--ra-text);
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .ra-app {
    background: #f7f7f7;
    border-radius: 28px;
    padding: 20px 24px 26px;
    max-width: 540px;
    width: 100%;
    box-shadow:
      0 18px 35px rgba(0, 0, 0, 0.45),
      0 0 0 3px rgba(0, 0, 0, 0.08);
    border: 4px solid var(--ra-secondary);
  }

  .ra-stage {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 18px;
  }

  .ra-wheel-wrapper {
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
  }

  /* ▼ FLECHA APUNTANDO HACIA ABAJO ▼ */
  .ra-pointer {
    width: 0;
    height: 0;
    border-left: 18px solid transparent;
    border-right: 18px solid transparent;
    border-top: 30px solid var(--ra-accent); /* ← Apunta hacia abajo */
    filter: drop-shadow(0 2px 3px rgba(0, 0, 0, 0.4));
    margin-bottom: 6px;
  }

  .ra-result-box {
    min-height: 52px;
    padding: 10px 16px;
    border-radius: 16px;
    border: 2px dashed var(--ra-secondary);
    background: #ffffff;
    text-align: center;
    font-size: 1rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    justify-content: center;
    max-width: 420px;
  }

  .ra-wheel {
    width: 260px;
    height: 260px;
    border-radius: 50%;
    border: 12px solid var(--ra-secondary);
    background: conic-gradient(
      #ffe0d6 0deg 30deg,
      #ffffff 30deg 60deg,
      #ffd2c4 60deg 90deg,
      #ffffff 90deg 120deg,
      #ffc1aa 120deg 150deg,
      #ffffff 150deg 180deg,
      #ffe0d6 180deg 210deg,
      #ffffff 210deg 240deg,
      #ffd2c4 240deg 270deg,
      #ffffff 270deg 300deg,
      #ffc1aa 300deg 330deg,
      #ffffff 330deg 360deg
    );
    box-shadow:
      0 10px 18px rgba(0, 0, 0, 0.45),
      inset 0 0 12px rgba(0, 0, 0, 0.35);
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    transition: transform 3.8s cubic-bezier(0.19, 0.9, 0.24, 1);
  }

  .ra-hub {
    width: 76px;
    height: 76px;
    border-radius: 50%;
    background: radial-gradient(circle at 30% 30%, #ffffff, #ffb199);
    border: 4px solid var(--ra-accent);
    box-shadow:
      0 0 0 3px #ffffff,
      0 0 10px rgba(0, 0, 0, 0.4),
      inset 0 0 6px rgba(0, 0, 0, 0.3);
  }

  .ra-button-wrapper {
    margin-top: 14px;
  }

  .ra-button {
    padding: 11px 28px;
    border-radius: 999px;
    border: none;
    font-size: 1rem;
    font-weight: 700;
    cursor: pointer;
    background: linear-gradient(135deg, var(--ra-accent), #ff7b3b);
    color: #000000;
    box-shadow:
      0 10px 18px rgba(0, 0, 0, 0.45),
      0 0 0 2px #ffffff;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    transition: transform 0.08s ease, box-shadow 0.08s ease, filter 0.08s ease;
  }

  .ra-button:active {
    transform: translateY(2px);
    box-shadow:
      0 5px 10px rgba(0, 0, 0, 0.4),
      0 0 0 2px #ffffff;
    filter: brightness(0.97);
  }

  .ra-button:disabled {
    opacity: 0.7;
    cursor: default;
    box-shadow:
      0 5px 10px rgba(0, 0, 0, 0.3),
      0 0 0 2px #ffffff;
  }

  @media (max-width: 520px) {
    .ra-app {
      margin: 10px;
      padding: 18px 16px 22px;
    }

    .ra-wheel {
      width: 220px;
      height: 220px;
    }

    .ra-result-box {
      font-size: 0.95rem;
    }
  }
</style>

<div id="ruleta-audiencias-widget" class="ruleta-audiencias-widget">
  <div class="ra-app">
    <div class="ra-stage">
      <div class="ra-wheel-wrapper">
        <div class="ra-pointer"></div>

        <div id="raResultBox" class="ra-result-box">
          Pulsa “Girar ruleta” para obtener una audiencia al azar.
        </div>

        <div id="raWheel" class="ra-wheel">
          <div class="ra-hub"></div>
        </div>
      </div>

      <div class="ra-button-wrapper">
        <button id="raSpinBtn" class="ra-button">Girar ruleta</button>
      </div>
    </div>
  </div>
</div>

<script>
  (function () {
    const audiences = [
      "Astrónomos aficionados",
      "Patinadores urbanos",
      "Jugadores de ajedrez",
      "Pescadores de río",
      "Baristas",
      "Cerveceros artesanales",
      "Fanáticos del anime",
      "Modelistas de trenes",
      "Cazadores de tormentas",
      "Fans del metal",
      "Apicultores",
      "Coleccionistas de monedas",
      "Ilusionistas",
      "Practicantes de parkour",
      "Speedrunners de videojuegos",
      "Jugadores de bridge",
      "Origamistas",
      "Bordadores",
      "Historiadores amateurs",
      "Corredores de maratón",
      "Triatletas",
      "Campistas solitarios",
      "Surfistas",
      "Escultores de madera",
      "Jardinistas urbanos",
      "Urbanistas activistas",
      "Skaters de downhill",
      "Jugadores de rol de mesa",
      "Fanáticos del cine clásico",
      "Cosplayers",
      "Booktubers",
      "Artistas de acuarela",
      "Conductores de kart",
      "Velocistas",
      "Pilotos de drones",
      "Foodies",
      "Amantes del té",
      "Reparadores de bicicletas",
      "Observadores de aves",
      "Fotógrafos callejeros",
      "Ceramistas",
      "Graffiteros",
      "Recolectores de hongos",
      "Minimalistas",
      "Maximalistas",
      "Fans del K-pop",
      "Jugadores de Pokémon competitivo",
      "Modelistas de aviones",
      "Tatuadores",
      "Fans de true crime",
      "Coleccionistas de vinilos",
      "Testeadores de gadgets",
      "Estampadores de serigrafía",
      "Bordadores de punto cruz",
      "Caricaturistas",
      "Fans de ciencia ficción",
      "Cinéfilos de terror",
      "Amantes del piano",
      "Constructores de Lego",
      "Viajeros mochileros",
      "Fans del fútbol retro",
      "Practicantes de taichí",
      "Poetas urbanos",
      "Músicos de jazz",
      "Amantes del teatro musical",
      "Fanáticos del rap freestyle",
      "Chefs veganos",
      "Chefs carnívoros",
      "Coleccionistas de antigüedades",
      "Restauradores de muebles",
      "Joyeros artesanales",
      "Jugadores de dominó",
      "Fans de Star Wars",
      "Fans de Star Trek",
      "Miniaturistas",
      "Cazadores de gangas",
      "Exploradores de cuevas",
      "Campers overlanding",
      "Vloggers de viajes",
      "Fans de la moda vintage",
      "Reparadores de tecnología antigua",
      "Amantes de los puzzles",
      "Speedcubers (cubos Rubik)",
      "Meditadores",
      "Practicantes de yoga aérea",
      "Jugadores de pinball",
      "Fans del cine independiente",
      "Amantes de los perros",
      "Amantes de los gatos",
      "Criadores de plantas raras",
      "Fans de la arqueología",
      "Buscadores de tesoros con detector",
      "Carpinteros aficionados",
      "Escultores de hielo",
      "Fanáticos del skate old school",
      "Bikers",
      "Corredores de autos RC",
      "Amantes de los cómics",
      "Fans del rock progresivo",
      "Jugadores de Magic: The Gathering",
      "Practicantes de kitesurf",
      "Jugadores de airsoft",
      "Fanáticos del motocross",
      "Cacharreros de hardware",
      "Filatelistas",
      "Cineastas caseros",
      "Astrólogos",
      "Tarotistas",
      "Fanáticos del misterio",
      "Simmers (The Sims)",
      "Jugadores de Minecraft",
      "Jugadores de Zelda",
      "Modelistas navales",
      "Numismáticos",
      "Fans del ballet",
      "Fans de la ópera",
      "Tejedores",
      "Cerveceros caseros",
      "Preparadores de café cold brew",
      "Coleccionistas de cámaras analógicas",  /* ← AQUÍ ESTABA EL ERROR, YA CORREGIDO */
      "Defensores del slow living",
      "Fans del minimalismo japonés",
      "Cocineros de recetas medievales",
      "Fans de las ferias renacentistas",
      "Lectores de fantasía épica",
      "Lectores de novelas románticas",
      "Lectores de thriller",
      "Replicadores de sables de luz",
      "Fans del steampunk",
      "Fans del cyberpunk",
      "Makers",
      "Fermentadores caseros",
      "Fanáticos del whisky",
      "Catadores de vino",
      "Diseñadores de moda",
      "Tejedores de macramé",
      "Amantes del hiking",
      "Montañistas",
      "Kayakistas",
      "Ciclistas urbanos",
      "Ciclistas de montaña",
      "Patinadores en hielo",
      "Bailarines de salsa",
      "Bailarines de tango",
      "Amantes de la danza contemporánea",
      "Fans de los eSports",
      "Jugadores de League of Legends",
      "Jugadores de Fortnite",
      "Jugadores de Valorant",
      "Jugadores de Counter-Strike",
      "Fanáticos de la Fórmula 1",
      "Fanáticos del rally",
      "Fans del automodelismo",
      "Metalúrgicos aficionados",
      "Inventores caseros",
      "VJ’s",
      "DJs de vinilo",
      "Amantes del ambient",
      "Fans del techno",
      "Fans del reggaetón viejo",
      "Fans de la música clásica",
      "Ilustradores digitales",
      "Creadores 3D",
      "Origamistas modulares",
      "Fans del ASMR",
      "Fans del mukbang",
      "Coleccionistas de juguetes retro",
      "Fans del stop motion",
      "Diseñadores de juegos de mesa",
      "Pintores de miniaturas",
      "Jugadores de dardos",
      "Fans de las cartas españolas",
      "Culturistas naturales",
      "Calisténicos",
      "Crossfitters",
      "Personas que coleccionan piedras",
      "Exploradores urbanos",
      "Graffiteros callados",
      "Bailarines de breakdance",
      "Fans de la cultura goth",
      "Fans de la cultura punk",
      "Fans de los 80s",
      "Fans de los 90s",
      "Coleccionistas de perfumes",
      "Amantes del DIY",
      "Fans del crochet",
      "Fans del metal melódico",
      "Fans de los documentales científicos",
      "Fans de la fotografía analógica",
      "Fans de los GIFs",
      "Usuarios de Reddit muy activos",
      "Amantes de las plantas carnívoras",
      "Pintores de óleo",
      "Amantes del arte abstracto",
      "Fans del hip hop consciente",
      "Patinadores artísticos",
      "Entrenadores de perros",
      "Criadores de gatos exóticos",
      "Amantes del cine mudo",
      "Fans del slapstick",
      "Lectores de cómics indie",
      "Fans del rock clásico",
      "Fans del pop coreano",
      "Amantes de la moda coreana",
      "Coleccionistas de stickers",
      "Jugadores de bochas",
      "Fans de los trenes",
      "Cronistas de viajes",
      "Fans de la música celta",
      "Jugadores de backgammon",
      "Catadores de chocolate",
      "Personas que aman organizar",
      "Fans del bullet journal",
      "Fans del scrapbooking",
      "Amantes de los perros salchicha",
      "Fans del senderismo extremo",
      "Fanáticos del camping invernal",
      "Gente que colecciona imanes",
      "Fans del origami simple",
      "Cazadores de auroras boreales",
      "Fans del cosplay histórico",
      "Fans del speed metal",
      "Practicantes de escalada en roca",
      "Bordadores de alta precisión",
      "Amantes del cine francés",
      "Fans de los videojuegos retro",
      "Jugadores de juegos de ritmo",
      "Streamers pequeños",
      "Fanáticos del minimal techno",
      "Fans de la música indie",
      "Fans de la mixología",
      "Personas que hacen compost",
      "Fans del bonsái",
      "Coleccionistas de figuras de acción",
      "Fans del watercooling en PC",
      "Mecánicos caseros",
      "Personas que restauran autos clásicos",
      "Amantes del picante",
      "Fans de las salsas fermentadas",
      "Fans del ramen",
      "Gente que cría gallinas en casa",
      "Fans del running nocturno",
      "Fans del cine soviético",
      "Usuarios de cámaras desechables",
      "Amantes del senderismo con perros",
      "Fans del arte naíf",
      "Gente que escribe diarios personales",
      "Amantes del café turco",
      "Fans del diseño nórdico",
      "Fans del rock alternativo"
    ];

    const root = document.getElementById("ruleta-audiencias-widget");
    if (!root) return;

    const wheel = root.querySelector("#raWheel");
    const spinBtn = root.querySelector("#raSpinBtn");
    const resultBox = root.querySelector("#raResultBox");

    let currentRotation = 0;
    let isSpinning = false;
    let clickInterval = null;
    let rollingTextInterval = null;
    let audioCtx = null;

    function getRandomAudience() {
      return audiences[Math.floor(Math.random() * audiences.length)];
    }

    function initAudio() {
      if (!audioCtx) {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      }
    }

    function playClickSound() {
      if (!audioCtx) return;
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      osc.type = "square";
      osc.frequency.setValueAtTime(2200, audioCtx.currentTime);
      gain.gain.setValueAtTime(0.18, audioCtx.currentTime);
      gain.gain.exponentialRampToValueAtTime(
        0.001,
        audioCtx.currentTime + 0.06
      );
      osc.connect(gain);
      gain.connect(audioCtx.destination);
      osc.start();
      osc.stop(audioCtx.currentTime + 0.07);
    }

    function startTicking() {
      stopTicking();
      clickInterval = setInterval(playClickSound, 70);
    }

    function stopTicking() {
      if (clickInterval) {
        clearInterval(clickInterval);
        clickInterval = null;
      }
    }

    function startResultRolling() {
      stopResultRolling();
      rollingTextInterval = setInterval(() => {
        resultBox.textContent = getRandomAudience();
      }, 80);
    }

    function stopResultRolling() {
      if (rollingTextInterval) {
        clearInterval(rollingTextInterval);
        rollingTextInterval = null;
      }
    }

    spinBtn.addEventListener("click", () => {
      if (isSpinning) return;

      initAudio();
      isSpinning = true;
      spinBtn.disabled = true;
      spinBtn.textContent = "Girando...";

      const extraRotation = Math.floor(Math.random() * 360);
      const fullSpins = 6;
      currentRotation += fullSpins * 360 + extraRotation;

      startTicking();
      startResultRolling();

      wheel.style.transform = `rotate(${currentRotation}deg)`;

      wheel.addEventListener(
        "transitionend",
        function handler() {
          wheel.removeEventListener("transitionend", handler);

          stopTicking();
          stopResultRolling();

          resultBox.textContent = getRandomAudience();

          spinBtn.disabled = false;
          spinBtn.textContent = "Girar ruleta";
          isSpinning = false;
        }
      );
    });
  })();
</script>
